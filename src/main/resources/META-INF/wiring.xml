<beans xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context"
  xmlns:util="http://www.springframework.org/schema/util"
  xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-3.1.xsd 
           http://www.springframework.org/schema/util 
           http://www.springframework.org/schema/util/spring-util-3.1.xsd">
  <context:component-scan base-package="com.mulesoft.mongo" />
  <!--<context:annotation-config /> -->

  <bean class="org.codehaus.jackson.jaxrs.JacksonJsonProvider"
    scope="singleton" />

  <bean id="appContext" class="com.mulesoft.mongo.util.AppContext" />

  <bean id="mongo" class="com.mulesoft.mongo.util.MongoFactoryBean">
    <property name="configuration" ref="configuration" />
    <!-- <property name="multiAddress"> <list> <value>${mongo.host.1}</value> 
      <value>${mongo.host.2}</value> <value>${mongo.host.3}</value> </list> </property> -->
  </bean>

  <bean
    class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="systemPropertiesModeName" value="SYSTEM_PROPERTIES_MODE_OVERRIDE" />
    <property name="ignoreUnresolvablePlaceholders" value="true" />
    <property name="properties">
      <value>
        startup.breather=0
        db.name=prod
        db.user=
        db.password=
        datastore.replicas=127.0.0.1
        mongo.master.host=127.0.0.1
      </value>
    </property>
  </bean>

  <bean id="configuration" class="com.mulesoft.mongo.util.Configuration"
    scope="singleton">
    <property name="startupBreather" value="${startup.breather}" />
    <property name="dataStoreName" value="${db.name}" />
    <property name="dataStoreReplicas" value="${datastore.replicas}" />
    <property name="dataStoreUsername" value="${db.user}" />
    <property name="dataStorePassword" value="${db.password}" />
  </bean>

  <bean id="shiroFilter" class="org.apache.shiro.spring.web.ShiroFilterFactoryBean">
    <property name="securityManager" ref="securityManager" />
    <property name="filterChainDefinitions">
      <value>
        /api/mongo/** = anon
      </value>
    </property>
  </bean>

  <bean id="securityManager" class="com.mulesoft.mongo.security.SecurityManager">
    <property name="realm" ref="realm" />
  </bean>

  <bean id="realm" class="com.mulesoft.mongo.security.Realm" />

  <bean id="lifecycleBeanPostProcessor" class="org.apache.shiro.spring.LifecycleBeanPostProcessor" />

  <bean
    class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="staticMethod"
      value="org.apache.shiro.SecurityUtils.setSecurityManager" />
    <property name="arguments" ref="securityManager" />
  </bean>

  <bean id="mongoService" class="com.mulesoft.mongo.service.MongoRestServiceImpl">
    <property name="mongo" ref="mongo" />
  </bean>
</beans>
